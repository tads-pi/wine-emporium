<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üç∑ Wine Emporium Shop</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<style>
  .container {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  }

  .add-user-form {
    width: fit-content;
    height: fit-content;
    padding: 2rem;
    outline: 1px solid black;
  }

  .users-table {
    width: 200px;
    height: 200px;
    outline: 1px solid black;
  }
</style>

<body>
  <div class="container">
    <!-- TODO ARRUMAR AS GAMBETINHAS  -->

    <!-- form to add user -->
    <div class="add-user-form">
      <h1>Criar Novo Usu√°rio</h1>
      <form id="new-user-form">
        <div class="form-group">
          <label for="exampleInputName">Nome</label>
          <input type="text" class="form-control" id="exampleInputName" aria-describedby="nameHelp"
            placeholder="Digite seu nome">
        </div>
        <div class="form-group">
          <label for="exampleInputCPF">CPF</label>
          <input type="text" class="form-control" id="exampleInputCPF" aria-describedby="cpfHelp"
            placeholder="Digite seu CPF">
        </div>
        <div class="form-group">
          <label for="exampleInputEmail1">Email</label>
          <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp"
            placeholder="Digite seu e-mail">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">Senha</label>
          <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Digite sua Senha">
        </div>

        <!-- options group for user group -->

        <div class="form-group">
          <label for="exampleFormControlSelect1">Grupo</label>
          <select class="form-control" id="exampleFormControlSelect1">
            <option>Administrador</option>
            <option>Cliente</option>
            <option>Funcion√°rio</option>
          </select>
        </div>

        <button type="submit" class="btn btn-primary">Enviar</button>
      </form>
    </div>

    <hr>
    <!-- get all users -->

    <h1>Usu√°rios</h1>
    <table class="table users-table">
      <thead>
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Nome</th>
          <th scope="col">CPF</th>
          <th scope="col">Email</th>
          <th scope="col">Ativo</th>
        </tr>
      </thead>
      <tbody id="table-users"></tbody>
    </table>
  </div>

  <script>
    const table = document.querySelector("#table-users")

    const allUsers = fetch('http://localhost:3000/backoffice/user')
      .then(response => response.json())
      .then(data => {
        data.forEach(user => {
          table.appendChild(newTR(user))
        })
      })


    function newTR(data) {
      const tr = document.createElement('tr')
      const button = document.createElement('button')
      button.style.color = data.active ? 'green' : 'red'
      button.textContent = data.active ? 'Ativo' : 'Inativo'
      button.addEventListener('click', () => {
        fetch(`http://localhost:3000/backoffice/user/${data.id}/toggle-active`, {
          method: 'DELETE',
        })
          .then(response => response.json())
          .then(data => {
            button.style.color = data.active ? 'green' : 'red'
            button.textContent = data.active ? 'Ativo' : 'Inativo'
          })
      })


      const updateButton = document.createElement('a')
      updateButton.textContent = "Editar"
      updateButton.href = `edit.html?user_id=${data.id}`

      tr.innerHTML = `
        <th scope="row">${data.id}</th>
        <td>${data.name}</td>
        <td>${data.document}</td>
        <td>${data.email}</td>
      `

      tr.appendChild(button)
      tr.appendChild(updateButton)

      return tr
    }


    const form = document.querySelector('#new-user-form')

    form.addEventListener('submit', (event) => {
      console.log('form submitted: ', event);
      event.preventDefault()

      const name = event.target.querySelector('#exampleInputName').value
      const document = event.target.querySelector('#exampleInputCPF').value
      const email = event.target.querySelector('#exampleInputEmail1').value
      const password = event.target.querySelector('#exampleInputPassword1').value
      const group = event.target.querySelector('#exampleFormControlSelect1').value

      fetch('http://localhost:3000/backoffice/user/save', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name,
          document,
          email,
          password,
          group
        })
      })
        .then(response => response.json())
        .then(data => {
          console.log(data);
          location.reload()
        })
    })

  </script>

</body>

</html>